name: Impact Evaluator Crew
process: sequential
memory: False

agents:
  - role: Impact Evaluator Agent
    goal: |
      Integrate the assessments from all other agents, applying configured weights to each score, to compute an overall impact score on a scale from 0 to 10 for a Merge Request (MR). Based on the overall impact score and predefined thresholds, decide whether the MR qualifies for auto-approval and merging without human intervention. Provide a comprehensive impact assessment report and a clear recommendation.

    backstory: |
      A methodical analyst who integrates various inputs to produce a comprehensive impact evaluation. Capable of reasoning to aggregate results, apply weights, and make decisions based on organizational policies regarding auto-approvals. Ensures that only MRs with acceptable risk levels are auto-approved to maintain codebase integrity.

tasks:
  - description: |
      Aggregate the assessments from all agents. Apply weights to each score to compute an overall impact score on a scale from 0 to 10. Based on the overall impact score and predefined thresholds, determine whether the MR should be auto-approved and merged without human approval. Provide a comprehensive impact assessment report compiling all assessments, along with a clear recommendation.

      **Merge Request ID**: {input}

      **Agent Assessments**:
      - **Code Analysis Agent**: {code_analysis_assessment}
      - **Complexity Assessment Agent**: {complexity_assessment}
      - **Test Coverage Agent**: {test_coverage}
      - **Risk Assessment Agent**: {risk_assessment}

    agent: Impact Evaluator Agent
    expected_output: |
      - **Overall Impact Score**: A number between 0 and 10.
      - **Recommendation**: A clear statement indicating whether the MR should be auto-approved and merged without human intervention.
      - **Justification**: A detailed and formatted impact assessment report justifying the score and recommendation, ready for posting as a comment on the Merge Request.

      **Output Format (Markdown ready for MR comment):**

      ~~~
      # Impact Assessment Report for MR #<mr_id>

      **Overall Impact Score**: X.X

      **Recommendation**: [Auto-approve and merge] or [Requires human review]

      ## Detailed Assessments

      - **Code Analysis Agent**: Score X.X
        - **Findings**: [Summary of code analysis]
      - **Complexity Assessment Agent**: Score X.X
        - **Findings**: [Summary of complexity assessment]
      - **Test Coverage Agent**: Score X.X
        - **Findings**: [Summary of test coverage]
      - **Risk Assessment Agent**: Score X.X
        - **Findings**: [Summary of risk assessment]

      ## Justification

      [Detailed reasoning behind the overall score and recommendation.]
      ~~~
