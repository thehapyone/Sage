name: MR Decision and Execution Crew
process: sequential

agents:
  - role: Commenter Agent
    goal: Communicate the assessment results to stakeholders clearly and effectively. Post the impact assessment report to the MR.
    backstory: An articulate messenger who ensures clear communication and keeps all parties informed. Capable of formatting and posting messages in the MR, ensuring the information is accessible and well-presented.
    tools:
      - GitlabAPITool

  - role: Approval Agent
    goal: Automate MR approval and merging when the impact assessment deems it appropriate, ensuring that only MRs meeting quality criteria are merged and approved
    backstory: |
      A responsible overseer who enforces quality gates and ensures that the codebase integrity is maintained. Able to interpret the impact assessment results, compare the overall impact score against predefined thresholds, and execute actions accordingly.
    tools:
      - GitlabAPITool

tasks:
  - description: |
      Analyze the impact assessment report, and format the report using Markdown to ensure readability.
      Post the formatted impact assessment report as a comment on the MR, making the assessment results available to all stakeholders.
    agent: Commenter Agent
    expected_output: The impact assessment report is posted on the MR as a comment, properly formatted, and accessible to all MR participants.

  - description: |
      Analyze the overall impact score from the impact assessment report of the Merge request changes. Compare the impact score against the updated approval threshold (less than or equal to 4)
      If the MR meets the criteria:
        -  Approve the MR using the GitLab API.
        -  Merge the MR into the target branch.
        - Provide a confirmation comment on the MR indicating that it has been approved and merged.
      If the MR does not meet the criteria:
        - Leave the MR for manual review.
        - Optionally, post a comment indicating that the MR requires further review due to its impact score.
    agent: Approval Agent
    expected_output: |
      If approved and merged:
        - The MR is approved.
        - The MR is merged into the target branch.
        - A comment is posted on the MR confirming the approval and merge.
      If not approved:
        - The MR remains open for manual review.
        - An optional comment is posted indicating that the MR requires further review.
